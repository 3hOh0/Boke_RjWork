# DjangoBlog 项目新增功能需求分析文档

## 一、项目概述

### 1.1 项目背景
DjangoBlog 是一款基于 Django 4.0 的现代化博客系统。为满足课程项目需求，计划在现有系统基础上新增4个功能模块，由4名团队成员分别开发，每人负责一个功能模块，预计每个模块核心功能代码量约2,500行，总计约10,000行。

### 1.2 项目目标
- 增强博客系统的交互性和用户体验
- 提供更完善的内容管理和数据分析功能
- 提升系统的实用性和可维护性

---

## 二、功能需求分析

### 功能1：读者互动增强（点赞/收藏功能）

#### 2.1.1 功能描述
为博客文章添加点赞和收藏功能，增强读者与内容的互动，提升用户粘性。

#### 2.1.2 功能需求
1. **点赞功能**
   - 用户可以对文章进行点赞/取消点赞
   - 显示文章总点赞数
   - 防止重复点赞（同一用户对同一文章只能点赞一次）
   - 支持AJAX异步操作，无需刷新页面
   - 点赞排行榜页面（最受欢迎文章TOP20）
   - 用户点赞历史记录查看
   - 点赞通知功能（文章作者收到点赞邮件通知）

2. **收藏功能**
   - 用户可以将文章添加到个人收藏夹
   - 用户可以查看自己的收藏列表（分页显示）
   - 支持取消收藏
   - 显示文章总收藏数
   - 收藏夹分类管理（创建、编辑、删除分类）
   - 文章可添加到多个收藏夹分类
   - 收藏文章搜索和筛选（按标题、分类、时间）

3. **我的收藏页面**
   - 收藏列表展示（卡片式布局）
   - 收藏分类筛选
   - 收藏时间排序
   - 批量删除收藏

#### 2.1.3 技术实现方案
- **数据模型**：创建 `Like`、`Favorite`、`FavoriteCategory` 模型，关联用户和文章
- **视图层**：实现点赞/收藏的API接口，支持AJAX请求；点赞排行榜视图；收藏夹管理视图；我的收藏页面
- **前端交互**：使用JavaScript实现异步提交，实时更新UI；收藏夹分类管理界面；搜索筛选功能
- **缓存优化**：对点赞数和收藏数进行缓存，减少数据库查询
- **通知系统**：集成邮件通知，文章作者收到点赞提醒

#### 2.1.4 预计代码量（负责人：成员1）
- Models: 280行（Like, Favorite, FavoriteCategory模型及方法）
- Views: 650行（点赞API、收藏API、排行榜、收藏夹管理、我的收藏）
- Forms: 220行（收藏夹分类表单、搜索筛选表单）
- URLs: 60行（路由配置）
- Templates: 900行（点赞按钮、收藏列表、收藏夹管理、排行榜、我的收藏页面）
- JavaScript: 450行（AJAX交互、收藏夹管理、搜索筛选、UI更新）
- Utils（通知功能）: 200行（邮件通知、通知模板）
- Admin配置: 140行（后台管理配置）
- **总计：约2,500行**

---

### 功能2：文章推荐/相似内容模块

#### 2.2.1 功能描述
基于文章标签、分类和内容相似度，为读者推荐相关文章，提升内容发现效率。

#### 2.2.2 功能需求
1. **相似文章推荐**
   - 在文章详情页显示"相关文章"模块
   - 基于标签匹配度推荐相似文章（计算共同标签数量）
   - 基于分类推荐同类别文章
   - 显示推荐文章列表（默认5篇）
   - 基于文章标题关键词匹配推荐

2. **推荐算法（简单易懂）**
   - 标签匹配算法：计算两篇文章的共同标签数，标签越多越相似
   - 分类匹配算法：同一分类下的文章优先推荐
   - 时间权重：优先推荐较新的文章（最近3个月）
   - 热度权重：浏览量高的文章优先推荐
   - 综合评分：标签匹配度 + 分类匹配度 + 时间权重 + 热度权重

3. **推荐展示**
   - 在文章详情页底部展示"相关文章"模块
   - 显示文章标题、摘要、发布时间、浏览量
   - 支持点击跳转到推荐文章详情
   - 卡片式布局，美观易读

4. **推荐管理（可选）**
   - 管理员可手动指定推荐文章（置顶推荐）
   - 推荐数量配置（3-10篇可调）

#### 2.2.3 技术实现方案
- **推荐算法**：实现简单的标签匹配、分类匹配、综合评分算法（避免复杂算法，易于理解）
- **算法模块**：创建独立的推荐工具类，封装推荐逻辑
- **视图层**：在文章详情视图中计算并传递推荐文章列表；推荐管理后台（可选）
- **模板集成**：在文章详情模板中添加推荐文章展示区域；推荐配置界面
- **缓存策略**：对推荐文章结果进行缓存（缓存1小时），提高响应速度

#### 2.2.4 预计代码量（负责人：成员2）
- Models扩展: 120行（推荐配置模型，可选）
- Views: 550行（推荐计算视图、推荐管理视图）
- Utils（推荐算法）: 650行（标签匹配、分类匹配、综合评分算法）
- Templates: 450行（推荐文章展示、推荐管理界面）
- JavaScript: 100行（推荐效果展示）
- URLs: 30行
- Admin配置: 100行
- 测试代码: 500行（单元测试、算法测试）
- **总计：约2,500行**

---

### 功能3：内容统计仪表盘

#### 2.3.1 功能描述
为管理员提供可视化的数据统计仪表盘，展示博客的关键运营指标。

#### 2.3.2 功能需求
1. **数据统计指标（简单易懂）**
   - 基础统计：文章总数、已发布文章数、草稿数
   - 访问统计：总浏览量（PV）、独立访客数（UV）
   - 互动统计：评论总数、点赞总数、收藏总数
   - 用户统计：用户注册数、活跃用户数（最近30天）
   - 排行榜：热门文章TOP10、热门作者TOP10
   - 趋势分析：最近7天/30天的数据趋势

2. **数据可视化（使用Chart.js）**
   - 折线图：展示访问量趋势（7天/30天）
   - 柱状图：展示文章发布趋势、分类分布
   - 饼图：展示分类分布、标签分布
   - 数字卡片：展示关键指标（大数字显示）

3. **统计页面布局**
   - 顶部：关键指标卡片（4-6个）
   - 中部：趋势图表（折线图、柱状图）
   - 底部：排行榜表格（热门文章、热门作者）

4. **权限控制**
   - 仅管理员可访问统计仪表盘
   - 使用Django权限系统进行访问控制

#### 2.3.3 技术实现方案
- **视图层**：创建Dashboard视图，聚合各类统计数据；API接口提供JSON数据
- **数据查询**：使用Django ORM进行数据聚合和统计（Count、Sum等）；优化查询性能
- **前端图表**：集成Chart.js库进行数据可视化；实现折线图、柱状图、饼图
- **统计工具类**：封装统计计算函数，便于复用
- **缓存策略**：对统计数据进行缓存（缓存10分钟），减少数据库压力

#### 2.3.4 预计代码量（负责人：成员3）
- Views: 600行（统计视图、API接口、数据聚合）
- Utils（统计函数）: 550行（各类统计计算、数据聚合函数）
- Templates: 700行（仪表盘界面、图表展示、排行榜表格）
- JavaScript（图表）: 400行（Chart.js集成、多种图表实现、数据加载）
- Forms: 80行（时间范围选择表单）
- URLs: 30行
- Admin配置: 40行
- 测试代码: 500行（统计功能测试）
- **总计：约2,500行**

---

### 功能4：文章自动保存功能

#### 2.4.1 功能描述
在文章编辑过程中自动保存草稿，防止因意外情况导致内容丢失，提升用户体验。

#### 2.4.2 功能需求
1. **自动保存机制（简单实现）**
   - 在文章编辑页面，每隔30秒自动保存一次
   - 保存文章标题、正文内容到草稿字段
   - 显示"已自动保存"提示信息（右上角提示）
   - 支持手动触发保存（保存按钮）
   - 保存失败时显示错误提示

2. **草稿管理**
   - 在文章列表显示草稿状态标识（草稿标签）
   - 支持从草稿恢复编辑（点击编辑按钮）
   - 显示最后保存时间（"最后保存：2024-01-01 12:00"）
   - 区分自动保存和手动保存（显示保存类型）

3. **版本历史（简化版）**
   - 保留最近5个自动保存版本
   - 支持查看历史版本列表（时间倒序）
   - 支持恢复到指定版本（一键恢复）
   - 显示版本保存时间

4. **前端交互**
   - 使用JavaScript定时器实现自动保存（setInterval）
   - AJAX异步提交，不中断用户编辑
   - 保存成功后显示提示（绿色提示框），失败时显示错误信息（红色提示框）
   - 页面关闭前检测是否有未保存内容（beforeunload事件）
   - 版本历史查看界面（弹窗或侧边栏）

#### 2.4.3 技术实现方案
- **数据模型**：创建`ArticleDraft`模型存储草稿内容；扩展Article模型添加草稿字段
- **视图层**：创建自动保存API接口；版本管理视图；版本恢复视图
- **前端实现**：使用setInterval定时器（30秒），监听编辑器内容变化；版本历史界面
- **防抖处理**：避免频繁保存，只在内容变化时保存
- **简单版本管理**：存储版本时间戳和内容，支持恢复（不实现复杂的差异对比）

#### 2.4.4 预计代码量（负责人：成员4）
- Models: 180行（ArticleDraft模型、Article扩展）
- Views: 500行（自动保存API、版本管理、版本恢复）
- Forms: 120行（版本恢复表单、草稿表单）
- Utils（工具函数）: 150行（草稿处理、版本管理工具）
- Templates: 650行（编辑界面扩展、版本历史界面、提示信息）
- JavaScript: 600行（自动保存逻辑、版本管理、UI交互、页面关闭检测）
- URLs: 40行
- Admin配置: 60行
- 测试代码: 500行（自动保存测试、版本管理测试）
- **总计：约2,500行**

---

## 三、功能优先级与开发计划

### 3.1 团队成员分工
| 成员 | 负责功能 | 预计代码量 | 难度等级 |
|------|---------|-----------|---------|
| 成员1 | 读者互动增强（点赞/收藏） | 2,500行 | ⭐⭐ 简单 |
| 成员2 | 文章推荐模块 | 2,500行 | ⭐⭐⭐ 中等 |
| 成员3 | 内容统计仪表盘 | 2,500行 | ⭐⭐⭐ 中等 |
| 成员4 | 文章自动保存 | 2,500行 | ⭐⭐ 简单 |
| **总计** | **4个功能模块** | **10,000行** | - |

### 3.2 开发阶段规划
- **并行开发**：4名成员可同时开发各自负责的功能模块，互不干扰
- **集成测试**：各功能开发完成后，统一进行集成测试
- **代码审查**：相互审查代码，确保代码质量

### 3.3 功能特点说明
- **简单易懂**：所有功能都采用简单直观的实现方式，避免过度复杂化
- **独立性强**：每个功能模块相对独立，减少相互依赖
- **代码均衡**：每个模块代码量约2,500行，工作量均衡分配

---

## 四、技术架构与依赖

### 4.1 技术栈
- **后端框架**：Django 4.0
- **数据库**：MySQL/SQLite（现有）
- **前端**：HTML5, CSS3, JavaScript (原生 + jQuery)
- **图表库**：Chart.js
- **缓存**：Redis（现有）

### 4.2 新增依赖
- Chart.js（用于数据可视化）
- 无需新增Python依赖包（使用Django原生功能）

### 4.3 数据库变更
- **功能1（成员1）**：新增 `Like` 表（用户点赞记录）、`Favorite` 表（用户收藏记录）、`FavoriteCategory` 表（收藏夹分类）
- **功能2（成员2）**：新增 `RecommendationConfig` 表（推荐配置，可选）
- **功能3（成员3）**：无需新增表，使用现有数据统计
- **功能4（成员4）**：新增 `ArticleDraft` 表（文章草稿版本）、扩展 `Article` 表（添加草稿字段）

---

## 五、非功能性需求

### 5.1 性能要求
- 点赞/收藏操作响应时间 < 200ms
- 推荐文章计算时间 < 100ms（使用缓存）
- 统计仪表盘页面加载时间 < 2s

### 5.2 兼容性要求
- 兼容现有DjangoBlog系统架构
- 不影响现有功能正常使用
- 支持现有插件系统

### 5.3 安全性要求
- 所有用户操作需进行权限验证
- 防止CSRF攻击
- 防止SQL注入和XSS攻击

---

## 六、风险评估

### 6.1 技术风险
- **低风险**：所有功能基于Django成熟技术栈，技术实现难度较低
- **缓存一致性**：点赞数缓存更新需要保证数据一致性

### 6.2 开发风险
- **时间风险**：4个功能模块开发工作量适中，预计可按时完成
- **集成风险**：需要与现有系统良好集成，避免冲突

---

## 七、验收标准

### 7.1 功能验收
- 所有功能模块按需求文档实现
- 功能测试通过率 100%
- 无明显Bug和性能问题

### 7.2 代码质量
- 代码符合PEP8规范
- 通过SonarQube代码质量检测
- 代码注释完整，可维护性良好

---

## 八、开发建议

### 8.1 开发顺序建议
1. **成员1（点赞/收藏）**：功能最简单，建议最先完成，可作为其他成员的参考
2. **成员4（自动保存）**：功能相对简单，可第二个完成
3. **成员2（文章推荐）**：需要理解推荐算法，建议第三个完成
4. **成员3（统计仪表盘）**：需要熟悉Chart.js，建议最后完成

### 8.2 技术难点提示
- **成员1**：注意AJAX异步请求的处理和错误处理
- **成员2**：推荐算法要简单易懂，避免过度复杂化
- **成员3**：Chart.js的使用需要熟悉，数据格式要正确
- **成员4**：定时器要注意清理，避免内存泄漏

### 8.3 代码规范
- 所有代码遵循PEP8规范
- 函数和类要有清晰的注释
- 变量命名要有意义，避免使用单字母变量
- 每个功能模块要有独立的测试文件

## 九、总结

本需求分析文档规划了4个新增功能模块，由4名团队成员分别负责开发，每个模块预计代码量约2,500行，总计约10,000行核心功能代码。所有功能均采用简单易懂的实现方式，基于现有DjangoBlog系统架构，技术实现可行，开发风险可控。功能模块涵盖用户交互、内容推荐、数据统计、内容管理等核心领域，能够有效提升博客系统的实用性和用户体验。团队成员可并行开发，互不干扰，提高开发效率。

