# DjangoBlog 项目功能实现位置说明

本文档用于快速了解当前仓库的目录结构，以及每个功能模块（含计划新增的 4 个功能）在代码中的实现位置，便于 4 名成员分工协作时快速定位文件，避免冲突。

---

## 1. 目录结构（截取主要目录）

```
├─ manage.py                 # Django 管理命令入口
├─ requirements.txt          # 依赖清单
├─ README.md / docs/         # 项目说明与部署文档
├─ djangoblog/               # 站点级配置 & 通用工具
│  ├─ settings.py            # 全局配置（数据库、缓存、插件等）
│  ├─ urls.py                # 顶层 URL，挂载各个 app
│  ├─ utils.py               # 通用工具函数（缓存、钩子、邮件等）
│  ├─ plugin_manage/         # 插件管理：hook 常量、加载器、注册器
│  └─ whoosh_cn_backend.py   # 搜索后端
├─ blog/                     # 核心博客业务
│  ├─ models.py              # 文章、分类、标签、侧边栏、站点配置
│  ├─ views.py               # 首页/详情/分类/归档/上传等页面
│  ├─ urls.py                # blog 子路由
│  ├─ templatetags/          # 自定义模板标签（侧边栏、文章列表等）
│  └─ management/commands/   # 自定义命令（生成测试数据、清缓存等）
├─ accounts/                 # 用户注册、登录、找回密码、OAuth 入口
├─ comments/                 # 评论系统（模型、表单、视图、模板标签）
├─ oauth/                    # 第三方登录扩展
├─ plugins/                  # 已实现的可插拔功能（浏览计数、SEO、推荐等）
├─ templates/                # 全局模板（blog/account/comments/share_layout…）
├─ static/                   # 原始静态资源（CSS/JS 字体等）
├─ locale/                   # 多语言翻译文件
└─ 其他 app
   ├─ owntracks/             # 地理位置追踪
   ├─ servermanager/         # 服务器管理相关
   └─ deploy/                # Docker / K8s / Nginx 配置
```

---

## 2. 现有核心功能对应位置

| 功能模块 | 主要目录/文件 | 说明 |
| --- | --- | --- |
| 文章、分类、标签 | `blog/models.py`、`blog/views.py`、`templates/blog/` | `Article`、`Category`、`Tag` 模型及前端展示页面。 |
| 评论系统 | `comments/models.py`、`comments/views.py`、`templates/comments/` | 支持嵌套评论、审核开关；通过 `blog.ArticleDetailView` 中的 `CommentForm` 引用。 |
| 用户与认证 | `accounts/models.py`、`accounts/views.py`、`accounts/forms.py`、`templates/account/` | 自定义 `BlogUser`、注册、登录、找回密码；后台用户管理通过 Django admin。 |
| OAuth 登录 | `oauth/` | 包含第三方登录视图、表单、模板，与 `djangoblog/settings.py` 中的配置联动。 |
| 搜索功能 | `blog/search_indexes.py`、`djangoblog/whoosh_cn_backend.py`、`blog/views.EsSearchView` | 集成 Haystack + Whoosh/ES，实现站内全文搜索。 |
| 插件系统 | `djangoblog/plugin_manage/`、`plugins/*/plugin.py` | 通过 hook 常量（`hook_constants.py`）和 `hooks.run_action` 执行插件回调。 |
| 站点设置/侧边栏 | `blog/models.BlogSettings`、`blog/models.SideBar`、`templates/share_layout/` | 在 admin 中配置站点信息、侧边栏内容，模板通过 `load_sidebar` 加载。 |
| API/管理命令 | `blog/management/commands/`、`servermanager/api/` | 自定义命令（生成测试数据、ping 搜索引擎）和后台管理接口。 |

---

## 3. 新增功能对应责任与落点

| 新增功能（负责人） | 建议放置的目录 & 关键文件 | 说明 |
| --- | --- | --- |
| **功能1：读者互动增强（成员1）**<br>点赞 / 收藏 / 收藏夹 | - `interaction/`（新建 app，便于隔离）<br>- `interaction/models.py`: `Like`、`Favorite`、`FavoriteCategory`<br>- `interaction/views.py` & `urls.py`: 点赞/收藏 API、排行榜、我的收藏页<br>- `templates/interaction/`、`blog/templates/blog/article_detail.html`：按钮、收藏列表、排行榜 UI<br>- `static/blog/js/interaction.js`：AJAX 交互 | 独立 app 方式最易维护；若不建新 app，也可将模型放在 `blog/models.py` 中的 “交互” 区域，视图/API 放 `blog/views.py` 或 `blog/api.py`（需新建）。 |
| **功能2：文章推荐（成员2）** | - 复用已有 `plugins/article_recommendation/` 或在 `blog/services/recommendation.py`（可新建 `blog/services/` 目录）实现算法<br>- `blog/views.ArticleDetailView` 中注入推荐列表<br>- `templates/blog/article_detail.html` 中新增推荐区块<br>- 配置项放 `blog/models.BlogSettings` / `djangoblog/settings.py` | 若采用插件方式，可在 `plugins/article_recommendation/plugin.py` 扩展；若希望更简单，可直接在 `blog/views.py` 中实现推荐逻辑。 |
| **功能3：内容统计仪表盘（成员3）** | - 新建 `dashboard/` app（包含 `views.py`、`urls.py`、`templates/dashboard/`）<br>- `dashboard/utils.py`：统计函数（聚合文章/评论/PV/UV 等）<br>- `static/dashboard/js/charts.js`：Chart.js 配置<br>- 在 `djangoblog/urls.py` 或 `blog/urls.py` 中挂载 `/dashboard/` | 与 admin 隔离，方便维护和权限控制；注意在 `settings.py` 中添加 app，并在 `templates/share_layout` 或 admin 菜单中添加入口。 |
| **功能4：文章自动保存（成员4）** | - 新建 `autosave` app 或在 `blog` app 内新增<br>- 模型：`ArticleDraft`（`blog/models.py` 或 `autosave/models.py`）<br>- 视图/API：`autosave/views.py`（提供 `POST /autosave/` 保存草稿、`GET /autosave/versions/` 获取版本）<br>- 前端：`templates/blog/admin/article_form.html` 或文章编辑器页面加入 JS（存放在 `static/blog/js/autosave.js`）<br>- 版本显示、恢复逻辑可放在 `templates/blog/article_edit.html` | 如果使用 Django admin 写作，可通过 admin 的自定义 form；若有前台写作页（自建模板），就在该模板中加载自动保存脚本。 |

> **建议**：四位成员各自建立独立 app（或至少独立目录）来承载新功能，避免大规模修改同一文件导致冲突。公共文件（例如 `blog/templates/blog/article_detail.html`）事先沟通好注入区域，或使用模板块/插件 hook 减少互相覆盖。

---

## 4. 防冲突协作要点

1. **分支**：每位成员创建自己的 feature 分支（如 `feature/interaction`、`feature/recommend`），完成后再合并主分支。
2. **模块隔离**：新功能尽量在独立 app/目录实现，仅通过 URL、模板块或 hook 与现有代码耦合。
3. **公共文件协调**：对需要共同修改的模板（例如 `article_detail.html`）先约定插入点或改用 `include`/`block`，减少 merge 冲突。
4. **迁移管理**：新增模型或字段时，及时运行 `makemigrations`，并在 PR 中说明依赖。
5. **定期同步**：每日 `git pull` 主分支、每周至少一次跨模块沟通，确保接口和数据模型一致。

---

通过以上说明，可以快速定位每个功能实现的目录与文件，方便团队成员各自开发并保持良好的协作。若目录结构或分工有调整，可在此文件中同步更新。

